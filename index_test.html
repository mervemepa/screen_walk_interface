<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Desktop Documentary</title>
    <style>
        :root {
            --teal: #008080;
            --deep: #004444;
            --bar: #c0c0c0;
            --bar2: #a0a0a0;
            --title1: #000080;
            --title2: #0000ff;
            --text: #111;
            --shadow: rgba(0, 0, 0, .4);
        }

        * {
            box-sizing: border-box
        }

        html,
        body {
            height: 100%;
            margin: 0
        }

        body {
            font-family: ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'MS Sans Serif', sans-serif;
            overflow: hidden;
            background: var(--teal)
        }

        .desktop {
            position: relative;
            width: 100vw;
            height: 100vh;
            background:
                radial-gradient(circle at 20% 20%, rgba(255, 255, 255, .1) 1px, transparent 1px),
                radial-gradient(circle at 80% 80%, rgba(255, 255, 255, .1) 1px, transparent 1px),
                linear-gradient(45deg, var(--teal) 0%, #006666 50%, var(--deep) 100%);
            background-size: 50px 50px, 50px 50px, 100% 100%;
        }

        .desktop-icons {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 10
        }

        .desktop-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 64px;
            color: #fff;
            font-size: 11px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, .8);
            cursor: default;
            padding: 4px;
            border-radius: 4px
        }

        .desktop-icon-image {
            width: 32px;
            height: 32px;
            background: #c0c0c0;
            border: 1px outset #c0c0c0;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px
        }

        .taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 30px;
            background: linear-gradient(to bottom, var(--bar) 0%, var(--bar2) 100%);
            border-top: 1px solid #dfdfdf;
            display: flex;
            align-items: center;
            padding: 0 4px;
            z-index: 1001
        }

        .start-button {
            background: linear-gradient(to bottom, var(--bar) 0%, var(--bar2) 100%);
            border: 1px outset var(--bar);
            padding: 2px 8px;
            font-size: 11px;
            font-weight: bold;
            margin-right: 4px
        }

        .taskbar-time {
            margin-left: auto;
            background: linear-gradient(to bottom, #dfdfdf 0%, var(--bar) 100%);
            border: 1px inset var(--bar);
            padding: 2px 8px;
            font-size: 11px
        }

        .window {
            position: absolute;
            background: #c0c0c0;
            border: 2px outset #c0c0c0;
            opacity: 0;
            transform: scale(.1);
            transition: all .6s cubic-bezier(.34, 1.56, .64, 1);
            min-width: 220px;
            max-width: 520px;
            box-shadow: 4px 4px 8px var(--shadow);
            z-index: 100
        }

        .window.open {
            opacity: 1;
            transform: scale(1)
        }

        .window-titlebar {
            background: linear-gradient(to right, var(--title1) 0%, var(--title2) 100%);
            height: 18px;
            display: flex;
            align-items: center;
            padding: 2px 4px;
            color: #fff;
            font-size: 11px;
            font-weight: bold;
            cursor: move
        }

        .window-controls {
            margin-left: auto;
            display: flex;
            gap: 2px
        }

        .window-control {
            width: 16px;
            height: 14px;
            background: #c0c0c0;
            border: 1px outset #c0c0c0;
            font-size: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-weight: bold
        }

        .window-control:active {
            border: 1px inset #c0c0c0
        }

        .window-title {
            margin-right: auto;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 240px
        }

        .window-content {
            padding: 8px;
            background: #c0c0c0;
            border-top: 1px solid #808080
        }

        .window-content img,
        .window-content video {
            display: block;
            max-width: 100%;
            max-height: 420px;
            border: 1px inset #c0c0c0;
            padding: 2px;
            background: #e6e6e6
        }

        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #c0c0c0;
            border: 2px outset #c0c0c0;
            padding: 10px;
            z-index: 1002;
            width: 240px
        }

        .controls h3 {
            margin: 0 0 8px 0;
            font-size: 12px;
            color: #000080
        }

        .btn {
            background: linear-gradient(to bottom, var(--bar) 0%, var(--bar2) 100%);
            border: 1px outset var(--bar);
            padding: 4px 8px;
            font-size: 11px;
            margin: 3px 0;
            display: inline-block
        }

        .btn:active {
            border: 1px inset var(--bar)
        }

        .btn.block {
            display: block;
            width: 100%
        }

        .btn.rec {
            background: linear-gradient(to bottom, #ff6b6b 0%, #ff5252 100%);
            color: #fff
        }

        .status {
            font-size: 10px;
            color: #333;
            margin-top: 4px;
            text-align: left;
            min-height: 16px
        }

        .row {
            display: flex;
            gap: 6px;
            align-items: center;
            margin: 4px 0
        }

        .row label {
            font-size: 11px;
            min-width: 80px
        }

        input[type="range"] {
            width: 100%
        }

        ul#playlist {
            margin: 6px 0 0 0;
            padding: 0;
            list-style: none;
            max-height: 110px;
            overflow: auto;
            border: 1px inset #bbb;
            background: #eee
        }

        #playlist li {
            padding: 4px 6px;
            border-bottom: 1px solid #ddd;
            font-size: 11px;
            display: flex;
            gap: 6px;
            align-items: center;
            cursor: grab
        }

        #playlist li:last-child {
            border-bottom: none
        }

        #playlist .handle {
            font-weight: bold
        }

        .hint {
            font-size: 10px;
            color: #444;
            margin-top: 6px
        }
    </style>
</head>

<body>
    <div class="desktop" id="desktop">
        <div class="desktop-icons">
            <div class="desktop-icon">
                <div class="desktop-icon-image">üìÅ</div><span>My Documents</span>
            </div>
            <div class="desktop-icon">
                <div class="desktop-icon-image">üóëÔ∏è</div><span>Recycle Bin</span>
            </div>
            <div class="desktop-icon">
                <div class="desktop-icon-image">üíª</div><span>My Computer</span>
            </div>
        </div>
    </div>

    <!-- Controls -->
    <div class="controls">
        <h3>Desktop Documentary</h3>
        <div class="row">
            <button class="btn" id="addBtn">üì• Medya Ekle</button>
            <button class="btn" id="demoBtn" title="√ñrnek 5 g√∂rsel y√ºkler">‚ú® Demo</button>
            <input type="file" id="filePicker" accept="image/*,video/*" multiple hidden />
        </div>

        <div class="row">
            <label for="speed">S√ºre (sn):</label>
            <input id="speed" type="range" min="1" max="8" step="0.5" value="3" />
            <span id="speedVal" style="font-size:11px">3.0</span>
        </div>

        <div class="row">
            <label for="maxWin">Maks Pencere:</label>
            <input id="maxWin" type="range" min="3" max="20" step="1" value="8" />
            <span id="maxWinVal" style="font-size:11px">8</span>
        </div>

        <div class="row">
            <label for="seed">Rastgele Tohum:</label>
            <input id="seed" type="number" value="" placeholder="opsiyonel" style="width:100%" />
        </div>

        <button class="btn block" id="startBtn">‚ñ∂ Ba≈ülat</button>
        <button class="btn block" id="resetBtn">üîÑ Reset</button>
        <button class="btn block rec" id="recBtn">‚è∫ Kayƒ±t</button>

        <div class="status" id="status">Dosya ekle veya Demo'ya bas.</div>

        <ul id="playlist"></ul>
        <div class="hint">Listede s√ºr√ºkle-bƒ±rak ile sƒ±ralamayƒ± deƒüi≈ütir.</div>
    </div>

    <!-- Taskbar -->
    <div class="taskbar">
        <div class="start-button">Start</div>
        <div class="taskbar-time" id="clock">12:00</div>
    </div>

    <script>
        /* ---------- State ---------- */
        let mediaItems = [];       // {name, type:'image'|'video', url, duration}
        let isRunning = false;
        let currentIndex = 0;
        let openWindows = [];
        let mediaRecorder = null;
        let recordedChunks = [];
        let isRecording = false;
        let rnd = Math.random;     // seed'lenebilir

        /* ---------- Helpers ---------- */
        function seededRandom(seed) {
            // Mulberry32
            let t = seed >>> 0;
            return function () {
                t += 0x6D2B79F5;
                let r = Math.imul(t ^ t >>> 15, 1 | t);
                r ^= r + Math.imul(r ^ r >>> 7, 61 | r);
                return ((r ^ r >>> 14) >>> 0) / 4294967296;
            }
        }

        function updateClock() {
            const now = new Date();
            const t = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            document.getElementById('clock').textContent = t;
        }
        setInterval(updateClock, 1000); updateClock();

        function px(n) { return `${n}px`; }

        /* ---------- Smart layout ---------- */
        function generateSmartPosition(index, total) {
            const screenWidth = window.innerWidth;
            const screenHeight = window.innerHeight - 60; // taskbar
            const cols = Math.ceil(Math.sqrt(total * 1.5));
            const rows = Math.ceil(total / cols);
            const cellW = screenWidth / cols;
            const cellH = screenHeight / rows;
            const col = index % cols;
            const row = Math.floor(index / cols);
            const baseX = col * cellW;
            const baseY = row * cellH;
            const randomX = (rnd() - .5) * cellW * 0.6;
            const randomY = (rnd() - .5) * cellH * 0.6;
            const x = Math.max(20, Math.min(baseX + randomX, screenWidth - 360));
            const y = Math.max(20, Math.min(baseY + randomY, screenHeight - 260));
            return { x, y };
        }

        function getRandomSize() {
            const sizes = ['small', 'medium', 'large'];
            return sizes[Math.floor(rnd() * sizes.length)];
        }

        /* ---------- Window creation + drag ---------- */
        function makeDraggable(win, handle) {
            let ox = 0, oy = 0, dragging = false;
            handle.addEventListener('mousedown', e => {
                dragging = true; ox = e.clientX - win.offsetLeft; oy = e.clientY - win.offsetTop;
                document.body.style.userSelect = 'none';
            });
            window.addEventListener('mousemove', e => {
                if (!dragging) return;
                win.style.left = px(e.clientX - ox);
                win.style.top = px(e.clientY - oy);
            });
            window.addEventListener('mouseup', () => {
                dragging = false; document.body.style.userSelect = '';
            });
        }

        function createWindow(item, index) {
            const desktop = document.getElementById('desktop');
            const win = document.createElement('div');
            win.className = `window ${getRandomSize()}`;
            win.id = `window-${index}`;

            const pos = generateSmartPosition(index, mediaItems.length);
            win.style.left = px(pos.x); win.style.top = px(pos.y);
            win.style.zIndex = 100 + index;

            const content = item.type === 'image'
                ? `<img src="${item.url}" alt="${item.name}" />`
                : `<video controls autoplay muted playsinline>
         <source src="${item.url}" type="video/mp4">
       </video>`;

            win.innerHTML = `
    <div class="window-titlebar">
      <div class="window-title" title="${item.name}">${item.name}</div>
      <div class="window-controls">
        <div class="window-control" data-act="min">_</div>
        <div class="window-control" data-act="max">‚ñ°</div>
        <div class="window-control" data-act="close">√ó</div>
      </div>
    </div>
    <div class="window-content">${content}</div>
  `;

            desktop.appendChild(win);
            openWindows.push(win);

            const titlebar = win.querySelector('.window-titlebar');
            makeDraggable(win, titlebar);

            // controls
            win.querySelector('.window-controls').addEventListener('click', (e) => {
                const act = e.target.getAttribute('data-act');
                if (act === 'close') closeWindow(win.id);
                if (act === 'min') win.style.opacity = .2;
                if (act === 'max') win.style.opacity = 1;
            });

            // appear
            setTimeout(() => { win.classList.add('open'); win.style.transform = 'scale(1)'; }, 50);

            // cap max open windows
            const maxOpen = parseInt(document.getElementById('maxWin').value, 10);
            if (openWindows.length > maxOpen) {
                const toClose = openWindows.shift();
                if (toClose) closeWindow(toClose.id, true);
            }
            return win;
        }

        function closeWindow(id, instant = false) {
            const w = document.getElementById(id);
            if (!w) return;
            if (instant) {
                w.remove();
            } else {
                w.style.transform = 'scale(.1)'; w.style.opacity = '0';
                setTimeout(() => w.remove(), 300);
            }
            openWindows = openWindows.filter(x => x.id !== id);
        }

        /* ---------- Playlist UI ---------- */
        const playlistEl = document.getElementById('playlist');
        function renderPlaylist() {
            playlistEl.innerHTML = '';
            mediaItems.forEach((m, i) => {
                const li = document.createElement('li');
                li.draggable = true;
                li.dataset.index = i;
                li.innerHTML = `<span class="handle">‚Üï</span> ${i + 1}. ${m.name} <span style="margin-left:auto">${m.type}</span>`;
                // drag events
                li.addEventListener('dragstart', e => {
                    e.dataTransfer.setData('text/plain', i.toString());
                });
                li.addEventListener('dragover', e => e.preventDefault());
                li.addEventListener('drop', e => {
                    e.preventDefault();
                    const from = parseInt(e.dataTransfer.getData('text/plain'), 10);
                    const to = parseInt(li.dataset.index, 10);
                    if (from === to) return;
                    const item = mediaItems.splice(from, 1)[0];
                    mediaItems.splice(to, 0, item);
                    saveLocal(); renderPlaylist();
                });
                playlistEl.appendChild(li);
            });
            document.getElementById('status').textContent = mediaItems.length
                ? `${mediaItems.length} medya y√ºklendi`
                : 'Dosya ekle veya Demo kullan.';
        }

        /* ---------- Local persistence ---------- */
        function saveLocal() { localStorage.setItem('dd_media', JSON.stringify(mediaItems.map(m => ({ name: m.name, type: m.type, url: m.url, duration: m.duration })))) }
        function loadLocal() {
            try {
                const raw = localStorage.getItem('dd_media');
                if (!raw) return;
                const arr = JSON.parse(raw);
                // Blob URL'leri yeni oturumda ge√ßersizdir, bu y√ºzden sadece name/type tutmak mantƒ±klƒ±.
                // Burada bilin√ßli olarak temiz bƒ±rakƒ±yoruz.
            } catch (_) { }
        }

        /* ---------- Media loading ---------- */
        function durationMs() { return parseFloat(document.getElementById('speed').value) * 1000; }

        async function addFiles(fileList) {
            const items = Array.from(fileList);
            for (const f of items) {
                const url = URL.createObjectURL(f);
                const type = f.type.startsWith('video') ? 'video' : 'image';
                mediaItems.push({ name: f.name, type, url, duration: durationMs() });
            }
            saveLocal(); renderPlaylist();
        }

        /* Demo loader (picsum) */
        async function loadDemo() {
            const urls = [600, 601, 602, 603, 604].map(h => `https://picsum.photos/800/${h}`);
            for (let i = 0; i < urls.length; i++) {
                const url = urls[i];
                mediaItems.push({ name: `demo_${i + 1}.jpg`, type: 'image', url, duration: durationMs() });
            }
            renderPlaylist();
        }

        /* ---------- Documentary flow ---------- */
        function openNext() {
            if (!isRunning || currentIndex >= mediaItems.length) { isRunning = false; return; }
            const item = mediaItems[currentIndex++];
            createWindow(item, currentIndex - 1);
            const delay = item.type === 'image' ? item.duration : 4000;
            setTimeout(openNext, delay);
        }

        function start() {
            if (!mediaItems.length) { document.getElementById('status').textContent = '√ñnce medya ekleyin.'; return; }
            reset();
            // seed
            const seedInput = document.getElementById('seed').value;
            rnd = seedInput ? seededRandom(parseInt(seedInput, 10) || 1) : Math.random;
            isRunning = true; currentIndex = 0;
            document.getElementById('status').textContent = 'Oynatƒ±lƒ±yor...';
            openNext();
        }

        function reset() {
            document.querySelectorAll('.window').forEach(w => w.remove());
            openWindows = []; currentIndex = 0; isRunning = false;
            document.getElementById('status').textContent = 'Resetlendi.';
        }

        /* ---------- Recording ---------- */
        async function toggleRecording() {
            const btn = document.getElementById('recBtn');
            const st = document.getElementById('status');
            if (isRecording) {
                mediaRecorder.stop();
                btn.textContent = '‚è∫ Kayƒ±t'; btn.classList.remove('rec');
                isRecording = false; return;
            }
            try {
                const stream = await navigator.mediaDevices.getDisplayMedia({
                    video: { width: { ideal: 1920 }, height: { ideal: 1080 }, frameRate: { ideal: 30 } }, audio: true
                });
                recordedChunks = [];
                mediaRecorder = new MediaRecorder(stream, { mimeType: 'video/webm;codecs=vp9' });
                mediaRecorder.ondataavailable = (e) => { if (e.data.size > 0) recordedChunks.push(e.data); };
                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { type: 'video/webm' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url; a.download = `desktop-documentary-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.webm`;
                    document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
                    st.textContent = 'Kayƒ±t indirildi (WEBM). MP4 istersen ffmpeg ile d√∂n√º≈üt√ºr.';
                    setTimeout(() => st.textContent = '', 3000);
                };
                mediaRecorder.start();
                btn.textContent = '‚èπ Durdur'; btn.classList.add('rec'); isRecording = true;
                st.textContent = 'Kayƒ±t ba≈üladƒ± (Chrome √∂nerilir).';
            } catch (err) {
                console.error(err); st.textContent = 'Kayƒ±t ba≈ülatƒ±lamadƒ± (izin?).';
                setTimeout(() => st.textContent = '', 3000);
            }
        }

        /* ---------- Wire up ---------- */
        document.getElementById('addBtn').onclick = () => document.getElementById('filePicker').click();
        document.getElementById('filePicker').onchange = (e) => addFiles(e.target.files);
        document.getElementById('demoBtn').onclick = loadDemo;
        document.getElementById('startBtn').onclick = start;
        document.getElementById('resetBtn').onclick = reset;
        document.getElementById('recBtn').onclick = toggleRecording;

        document.getElementById('speed').oninput = (e) => {
            document.getElementById('speedVal').textContent = parseFloat(e.target.value).toFixed(1);
            // yeni eklenen g√∂rsellere bu s√ºre gitsin; mevcutlarƒ± olduƒüu gibi bƒ±rakƒ±yoruz
        };
        document.getElementById('maxWin').oninput = (e) => document.getElementById('maxWinVal').textContent = e.target.value;

        /* drag-drop to desktop */
        const desktop = document.getElementById('desktop');
        desktop.addEventListener('dragover', e => { e.preventDefault(); });
        desktop.addEventListener('drop', e => {
            e.preventDefault();
            if (e.dataTransfer.files && e.dataTransfer.files.length) addFiles(e.dataTransfer.files);
        });

        /* init */
        loadLocal(); renderPlaylist();
    </script>
</body>

</html>